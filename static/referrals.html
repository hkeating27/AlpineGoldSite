<!DOCTYPE html>
<html>
<head>
  <title>Your Referrals</title>
  <style>body{font-family:Arial,sans-serif;margin:20px;}#login-status{margin-bottom:20px;}ul{margin-top:10px;}</style>
</head>
<body>
  <div id="login-status"></div>
  <h2>People You've Referred</h2>
  <ul id="result_list"></ul>
  <a href="/logout">Log out</a>
  <script>
    document.addEventListener('DOMContentLoaded',()=>{
      fetch('/whoami',{credentials:'include'}).then(r=>r.json()).then(d=>{if(!d.username)return window.location.href='/login';document.getElementById('login-status').textContent=`Logged in as ${d.username}`;getReferred(d.username);});
    });
    function getReferred(username){fetch(`/get_by_referrer?referred_by=${encodeURIComponent(username)}`,{credentials:'include'}).then(r=>{if(!r.ok)throw'';return r.json()}).then(arr=>{const ul=document.getElementById('result_list');ul.innerHTML='';if(!arr.length)ul.innerHTML='<li>No one yet</li>';else arr.forEach(a=>{let li=document.createElement('li');li.textContent=a[0]+' '+a[1];ul.appendChild(li);});}).catch(()=>alert('Error retrieving'));}
  </script>
</body>
</html>
