<!DOCTYPE html>
<html>
<head>
  <title>Referred People</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    input, button { margin: 5px 0; display: block; }
  </style>
</head>
<body>
  <h2>See People Referred By</h2>
  <label>Referrer Name:</label>
  <input type="text" id="query_referrer" placeholder="Type a name...">
  <button onclick="getReferred()">Get List</button>

  <ul id="result_list"></ul>

  <script>
    // If someone pre‑linked with ?referred_by=XXX, fill it in on load:
    document.addEventListener('DOMContentLoaded', () => {
      const p = new URLSearchParams(window.location.search);
      const pre = p.get('referred_by');
      if (pre) {
        document.getElementById('query_referrer').value = pre;
        getReferred();
      }
    });

    function getReferred() {
      const ref = document.getElementById('query_referrer').value.trim();
      if (!ref) return alert('Please enter a referrer name.');

      // NOTE: use a *relative* URL, not hard‑coded localhost
      fetch(`/get_by_referrer?referred_by=${encodeURIComponent(ref)}`)
        .then(res => {
          if (!res.ok) throw new Error(res.status + ' ' + res.statusText);
          return res.json();
        })
        .then(data => {
          const list = document.getElementById('result_list');
          list.innerHTML = '';
          if (data.length === 0) {
            list.innerHTML = '<li>No entries found.</li>';
            return;
          }
          data.forEach(([first, last]) => {
            const li = document.createElement('li');
            li.textContent = first + ' ' + last;
            list.appendChild(li);
          });
        })
        .catch(err => {
          console.error(err);
          alert('Error retrieving list');
        });
    }
     function getReferred() {
        const ref = document.getElementById('query_referrer').value.trim();
        fetch(`/get_by_referrer?referred_by=${encodeURIComponent(ref)}`)
          .then(res => {
            if (res.status === 401 || res.status === 403) {
              // not logged in, or wrong user
              return window.location.href = `/login?ref=${encodeURIComponent(ref)}`;
            }
            if (!res.ok) throw new Error();
            return res.json();
          })
          .then(data => {
            // … populate your list as before …
          })
          .catch(() => alert('Error retrieving list'));
      }
  </script>
</body>
</html>
