<!DOCTYPE html>
<html>
<head>
  <title>Create Account</title>
  <style>body{font-family:Arial,sans-serif;margin:20px;}input,button{margin:5px 0;display:block;}</style>
</head>
<body>
  <h2>Create Account for: <strong id="ref-name"></strong></h2>
  <input type="text" id="username" placeholder="Username">
  <input type="password" id="password" placeholder="Password">
  <input type="password" id="confirm_password" placeholder="Confirm Password">
  <button onclick="register()">Create Account</button>
  <script>
    const p=new URLSearchParams(window.location.search),ref=p.get('ref')||'';document.getElementById('ref-name').textContent=ref;
    function register(){const u=document.getElementById('username').value.trim(),pw=document.getElementById('password').value,cp=document.getElementById('confirm_password').value;if(!u||!pw)return alert('Required');if(pw!==cp)return alert('Passwords differ');fetch('/register',{method:'POST',credentials:'include',headers:{'Content-Type':'application/json'},body:JSON.stringify({username:u,password:pw})}).then(r=>r.text().then(t=>({ok:r.ok,txt:t}))).then(o=>{if(o.ok){alert('Created');window.location.href=`/login?ref=${encodeURIComponent(ref)}`;}else alert('Error: '+o.txt)}).catch(()=>alert('Fail'));}
  </script>
</body>
</html>
